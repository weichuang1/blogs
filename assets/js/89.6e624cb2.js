(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{606:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"跨域通信的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域通信的方式"}},[s._v("#")]),s._v(" 跨域通信的方式")]),s._v(" "),a("ul",[a("li",[s._v("JSONP")]),s._v(" "),a("li",[s._v("CORS")]),s._v(" "),a("li",[s._v("Hash")]),s._v(" "),a("li",[s._v("postMessage")]),s._v(" "),a("li",[s._v("WebSoket")])]),s._v(" "),a("h3",{attrs:{id:"同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[s._v("#")]),s._v(" 同源策略")]),s._v(" "),a("ul",[a("li",[s._v("端口相同")]),s._v(" "),a("li",[s._v("域名相同")]),s._v(" "),a("li",[s._v("协议相同")])]),s._v(" "),a("p",[s._v("例子："),a("code",[s._v("http://www.example.com/dir/page.html")]),s._v(" 这个网址，协议是"),a("code",[s._v("http")]),s._v("，域名是"),a("code",[s._v("www.example.com")]),s._v("，端口是"),a("code",[s._v("80")])]),s._v(" "),a("p",[s._v("同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。"),a("strong",[s._v("是浏览器做的努力")])]),s._v(" "),a("h3",{attrs:{id:"同源策略限制范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略限制范围"}},[s._v("#")]),s._v(" 同源策略限制范围")]),s._v(" "),a("ul",[a("li",[s._v("Cookie、LocalStorage 和 IndexDB 无法读取")]),s._v(" "),a("li",[s._v("DOM 无法获得")]),s._v(" "),a("li",[s._v("AJAX 请求不能发送")])]),s._v(" "),a("h3",{attrs:{id:"cros跨域资源请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cros跨域资源请求"}},[s._v("#")]),s._v(" CROS跨域资源请求")]),s._v(" "),a("p",[s._v("CORS(Cross-origin resource sharing)跨域资源请求")]),s._v(" "),a("p",[s._v("浏览器在请求一个跨域资源的时候，如果是跨域的Ajax请求，他会在请求头中加一个"),a("code",[s._v("origin")]),s._v("字段，但他是不知道这个资源服务端是否允许跨域请求的。浏览器会发送到服务端，如果服务器返回的头中没有"),a("code",[s._v("'Access-Control-Allow-Origin': '对应网址或 * '")]),s._v(" 的话，那么浏览器就会把请求内容给忽略掉，并且在控制台报错")]),s._v(" "),a("h3",{attrs:{id:"cors限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors限制"}},[s._v("#")]),s._v(" CORS限制")]),s._v(" "),a("p",[s._v("允许的请求方法")]),s._v(" "),a("ul",[a("li",[s._v("GET")]),s._v(" "),a("li",[s._v("POST")]),s._v(" "),a("li",[s._v("HEAD")])]),s._v(" "),a("p",[s._v("允许的Content-Type")]),s._v(" "),a("ul",[a("li",[s._v("text/plain")]),s._v(" "),a("li",[s._v("multipart/form-data")]),s._v(" "),a("li",[s._v("application/x-www-form-ulencoded")])]),s._v(" "),a("p",[s._v("其他类型的请求方法和Content-Type需要通过"),a("strong",[s._v("预请求验证")]),s._v("后然后才能发送")]),s._v(" "),a("h3",{attrs:{id:"cors预请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors预请求"}},[s._v("#")]),s._v(" CORS预请求")]),s._v(" "),a("p",[s._v("跨域资源共享标准新增了一组 HTTP 首部字段，允许服务器声明哪些源站有权限访问哪些资源。另外，规范要求，对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求），浏览器必须首先使用 OPTIONS 方法发起一个预检请求。")]),s._v(" "),a("p",[s._v("服务器在HTTP header中加入允许请求的方法和Content-Type后，其他指定的方法和Content-Type就可以成功请求了")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("'Access-Control-Allow-Headers': '允许Content-Type'\n'Access-Control-Allow-Methods': '允许的请求方法'\n'Access-Control-Max-Age': '预请求允许其他方法和类型传输的时间'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"jsonp跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp跨域"}},[s._v("#")]),s._v(" JSONP跨域")]),s._v(" "),a("p",[s._v("浏览器上虽然有同源限制，但是像 srcipt标签、link标签、img标签、iframe标签，这种"),a("strong",[s._v("在标签上通过src地址来加载一些内容的时候浏览器是允许进行跨域请求的")]),s._v("。")]),s._v(" "),a("p",[s._v("所以JSONP的原理就是：")]),s._v(" "),a("ul",[a("li",[s._v("创建一个script标签，这个script标签的src就是请求的地址；")]),s._v(" "),a("li",[s._v("这个script标签插入到DOM中，浏览器就根据src地址访问服务器资源")]),s._v(" "),a("li",[s._v("返回的资源是一个文本，但是因为是在script标签中，浏览器会执行它")]),s._v(" "),a("li",[s._v("而这个文本恰好是函数调用的形式，即函数名（数据），浏览器会把它当作JS代码来执行即调用这个函数")]),s._v(" "),a("li",[s._v("只要提前约定好这个函数名，并且这个函数存在于window对象中，就可以把数据传递给处理函数。")])]),s._v(" "),a("h3",{attrs:{id:"hash值跨域通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash值跨域通信"}},[s._v("#")]),s._v(" Hash值跨域通信")]),s._v(" "),a("p",[s._v("背景：在页面A下提供iframe或frame嵌入了跨域的页面B")]),s._v(" "),a("p",[s._v("容器页面 -> 嵌入页通信：")]),s._v(" "),a("p",[s._v("在A页面中改变B的url中的hash值，B不会刷新，但是B可以用过"),a("code",[s._v("window.onhashchange")]),s._v("事件监听到hash变化")]),s._v(" "),a("h3",{attrs:{id:"postmessage通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postmessage通信"}},[s._v("#")]),s._v(" postMessage通信")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 窗口A中")]),s._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://A.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 窗口B中")]),s._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// http://A.com")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// A 对象window引用")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"websoket-跨域通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websoket-跨域通信"}},[s._v("#")]),s._v(" WebSoket 跨域通信")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" ws "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wss://echo.websoket.org'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//这个是后端端口")]),s._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onopen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'some message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onmessage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("evt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onclose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'连接关闭'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"document-domain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-domain"}},[s._v("#")]),s._v(" document.domain")]),s._v(" "),a("p",[s._v("该方式只能用于二级域名相同的情况下，比如 a.test.com 和 b.test.com 适用于该方式。")]),s._v(" "),a("p",[s._v("只需要给页面添加 document.domain = 'test.com' 表示二级域名都相同就可以实现跨域")])])}),[],!1,null,null,null);t.default=e.exports}}]);